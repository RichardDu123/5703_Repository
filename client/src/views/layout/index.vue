<template>
  <div class="container" v-if="isETHLoaded">
    <div class="main">
      <router-view></router-view>
    </div>
    <transition name="left">
      <div class="left" v-show="showLeft">
        <h2>{{ name }}</h2>
        <nav>
          <ul @click="handleClick">
            <li id="dashboard">
              <div class="navItem" :class="{ active: currentNav === '/' }">
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 20 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M7.13478 18.7733V15.7156C7.13478 14.9351 7.77217 14.3023 8.55844 14.3023H11.4326C11.8102 14.3023 12.1723 14.4512 12.4393 14.7163C12.7063 14.9813 12.8563 15.3408 12.8563 15.7156V18.7733C12.8539 19.0978 12.9821 19.4099 13.2124 19.6402C13.4427 19.8705 13.7561 20 14.0829 20H16.0438C16.9596 20.0023 17.8388 19.6428 18.4872 19.0008C19.1356 18.3588 19.5 17.487 19.5 16.5778V7.86686C19.5 7.13246 19.1721 6.43584 18.6046 5.96467L11.934 0.675869C10.7737 -0.251438 9.11111 -0.221498 7.98539 0.746979L1.46701 5.96467C0.872741 6.42195 0.517552 7.12064 0.5 7.86686V16.5689C0.5 18.4639 2.04738 20 3.95617 20H5.87229C6.55123 20 7.103 19.4562 7.10792 18.7822L7.13478 18.7733Z"
                    fill="#B8BED9"
                  />
                </svg>
                <span>Dashboard</span>
              </div>
            </li>
            <li id="buy">
              <div class="navItem" :class="{ active: currentNav === '/buy' }">
                <svg
                  width="12"
                  height="18"
                  viewBox="0 0 12 18"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M6.3607 10.1634L6.00661 10.165C4.53497 10.165 3.19332 10.0788 2.31871 9.94897L1.77483 9.83524C1.48678 9.77197 1.1588 9.68879 0.991371 9.60207C0.378924 9.28461 0 8.66389 0 7.99954V7.94172C0.0143198 7.50864 0.394346 6.59883 0.407564 6.59883C1.02183 5.13485 2.87572 2.31046 4.19739 1.006L4.59419 0.626929C4.70173 0.527664 4.82901 0.41614 4.92822 0.346905C5.23444 0.115635 5.61337 0 5.99229 0C6.41527 0 6.80852 0.129817 7.13016 0.375268L7.55047 0.764728L7.64017 0.85199C8.92344 2.03561 11.0218 5.12612 11.664 6.74283L11.7576 6.98692C11.8629 7.28064 11.9884 7.69218 12 7.94172C12 8.25917 11.9262 8.56244 11.7808 8.85153C11.577 9.21262 11.2554 9.50061 10.8764 9.65988C10.6143 9.76134 9.82669 9.92061 9.81237 9.92061C9.01826 10.0666 7.76518 10.1513 6.3607 10.1634ZM5.99956 18C5.1613 18 4.48166 17.3269 4.48166 16.4967L4.80881 12.7975C4.80881 12.1463 5.34195 11.6183 5.99956 11.6183C6.65827 11.6183 7.19031 12.1463 7.19031 12.7975L7.51746 16.4967C7.51746 17.3269 6.83782 18 5.99956 18Z"
                  />
                </svg>
                <span>Buy</span>
              </div>
            </li>
            <li id="sell">
              <div class="navItem" :class="{ active: currentNav === '/sell' }">
                <svg
                  width="12"
                  height="18"
                  viewBox="0 0 12 18"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M5.99339 7.83503C7.46503 7.83503 8.80668 7.92121 9.68129 8.05103C9.6835 8.05305 9.70532 8.05804 9.7421 8.06561L9.99273 8.11578C10.3127 8.18079 10.7934 8.28643 11.0086 8.39793C11.6211 8.71539 12 9.33611 12 10.0005V10.0583C11.9857 10.4914 11.6057 11.4012 11.5924 11.4012C10.9502 12.9317 8.95319 15.9491 7.62585 17.1622L7.58042 17.207C7.48045 17.3048 7.23713 17.5377 7.07178 17.6531C6.76556 17.8844 6.38663 18 6.00771 18C5.58473 18 5.19148 17.8702 4.86984 17.6247C4.81146 17.5669 4.56471 17.3509 4.35983 17.148C3.07656 15.9644 0.978153 12.8739 0.335965 11.2572C0.233523 11.0117 0.0154213 10.391 0 10.0583C0 9.74083 0.0738021 9.43756 0.219203 9.14847C0.422985 8.78738 0.74463 8.49939 1.12355 8.34012C1.38572 8.23866 2.17331 8.07939 2.18763 8.07939C3.04792 7.92121 4.44685 7.83503 5.99339 7.83503ZM6.00044 0C6.8387 0 7.51834 0.673083 7.51834 1.50325L7.19119 5.20248C7.19119 5.85375 6.65805 6.38174 6.00044 6.38174C5.34173 6.38174 4.80969 5.85375 4.80969 5.20248L4.48254 1.50325C4.48254 0.673083 5.16218 0 6.00044 0Z"
                  />
                </svg>
                <span>Sell</span>
              </div>
            </li>
            <li id="myPosts">
              <div
                class="navItem"
                :class="{ active: currentNav === '/myPosts' }"
              >
                <svg
                  class="posts"
                  width="30"
                  height="30"
                  viewBox="0 0 30 30"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M9.8117 27.7333C8.36006 27.2996 5.0406 25.0202 2.11704 13.6127L0.0157271 25.4841C-0.00766043 25.6146 -0.00494029 25.7484 0.023732 25.8778C0.0524042 26.0072 0.106466 26.1298 0.182829 26.2384C0.259191 26.3471 0.356356 26.4397 0.468771 26.511C0.581185 26.5824 0.706645 26.631 0.837979 26.6541L19.8513 29.9826C20.1092 30.0308 20.376 29.978 20.5955 29.835C20.8151 29.6921 20.9704 29.4703 21.0288 29.216L21.6075 25.9279L10.2685 27.9452L9.8117 27.7333ZM29.7589 20.8848C26.6323 17.1126 24.3179 6.26994 23.6783 2.99193C23.6266 2.7321 23.4742 2.50289 23.2539 2.3538C23.0335 2.20472 22.763 2.14772 22.5008 2.19512L17.5876 2.99193C17.757 3.66252 17.7858 4.36056 17.6723 5.04269C17.5588 5.72482 17.3053 6.37646 16.9276 6.95715C16.5499 7.53783 16.056 8.03514 15.4767 8.41819C14.8974 8.80125 14.245 9.06185 13.5601 9.18383C12.8752 9.3058 12.1723 9.28653 11.4952 9.12722C10.818 8.96791 10.1811 8.67196 9.62394 8.25775C9.06678 7.84355 8.60128 7.31994 8.25638 6.71944C7.91148 6.11895 7.69454 5.45441 7.61902 4.7671L3.49761 5.49331C3.36422 5.51629 3.23681 5.56555 3.12286 5.63819C3.00892 5.71083 2.91075 5.80538 2.83414 5.91628C2.75752 6.02718 2.704 6.15218 2.67673 6.28394C2.64947 6.41569 2.649 6.55154 2.67536 6.68348C3.4164 10.486 6.27906 23.83 10.0452 25.6758C10.2398 25.7722 10.4604 25.804 10.6746 25.7665L29.16 22.5289C29.3348 22.4985 29.4984 22.4231 29.6347 22.3102C29.771 22.1974 29.8752 22.051 29.9368 21.8857C29.9984 21.7204 30.0154 21.5419 29.9859 21.3681C29.9565 21.1942 29.8817 21.0311 29.7691 20.8949L29.7589 20.8848ZM12.6134 7.02641C13.1764 7.02316 13.7275 6.86491 14.2054 6.56925C14.6833 6.27358 15.0694 5.85208 15.3208 5.35154C15.5721 4.85101 15.6789 4.29104 15.6293 3.73384C15.5796 3.17664 15.3755 2.64401 15.0396 2.19512C15.0433 2.12457 15.0433 2.05387 15.0396 1.98331C15.0315 1.5065 14.8537 1.04794 14.5377 0.689023C14.2217 0.330104 13.7879 0.0940311 13.3133 0.0226991C12.8388 -0.048633 12.3541 0.0493887 11.9454 0.299369C11.5366 0.54935 11.2303 0.935123 11.0806 1.38823C10.5033 1.72349 10.0532 2.23821 9.79955 2.85294C9.54595 3.46767 9.50303 4.14825 9.6774 4.78963C9.85177 5.43101 10.2337 5.99755 10.7644 6.4018C11.295 6.80605 11.9448 7.02554 12.6134 7.02641Z"
                  />
                </svg>

                <span>My Posts</span>
              </div>
            </li>
            <li id="myReplies">
              <div
                class="navItem"
                :class="{ active: currentNav === '/myReplies' }"
              >
                <svg
                  width="24"
                  height="22"
                  viewBox="0 0 24 22"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M11.6959 0.245972C5.3879 0.245972 0.295898 4.99597 0.295898 10.886C0.295898 12.786 0.827899 14.534 1.7399 16.092C1.8539 16.282 1.8919 16.51 1.8159 16.7L0.751898 20.082C0.561898 20.69 1.1319 21.222 1.7399 21.032L5.0839 19.854C5.3119 19.778 5.5399 19.816 5.7299 19.93C7.4779 20.956 9.5299 21.526 11.7339 21.526C18.0419 21.526 23.1339 16.776 23.1339 10.886C23.0579 4.99597 17.9659 0.245972 11.6959 0.245972Z"
                  />
                </svg>

                <span>My Replies</span>
              </div>
            </li>
            <li id="statistics">
              <div
                class="navItem"
                :class="{ active: currentNav === '/statistics' }"
              >
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 20 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M13.4498 1.7803C13.4098 2.0303 13.3898 2.2803 13.3898 2.5303C13.3898 4.7803 15.2098 6.5993 17.4498 6.5993C17.6998 6.5993 17.9398 6.5703 18.1898 6.5303V14.5993C18.1898 17.9903 16.1898 20.0003 12.7898 20.0003H5.40076C1.99976 20.0003 -0.000244141 17.9903 -0.000244141 14.5993V7.2003C-0.000244141 3.8003 1.99976 1.7803 5.40076 1.7803H13.4498ZM13.6508 7.8603C13.3798 7.8303 13.1108 7.9503 12.9498 8.1703L10.5308 11.3003L7.75976 9.1203C7.58976 8.9903 7.38976 8.9393 7.18975 8.9603C6.99076 8.9903 6.81076 9.0993 6.68975 9.2593L3.73076 13.1103L3.66976 13.2003C3.49976 13.5193 3.57976 13.9293 3.87976 14.1503C4.01976 14.2403 4.16976 14.3003 4.33976 14.3003C4.57076 14.3103 4.78976 14.1893 4.92976 14.0003L7.43975 10.7693L10.2898 12.9103L10.3798 12.9693C10.6998 13.1393 11.0998 13.0603 11.3298 12.7593L14.2198 9.0303L14.1798 9.0503C14.3398 8.8303 14.3698 8.5503 14.2598 8.3003C14.1508 8.0503 13.9098 7.8803 13.6508 7.8603ZM17.5899 0C18.9199 0 19.9999 1.08 19.9999 2.41C19.9999 3.74 18.9199 4.82 17.5899 4.82C16.2599 4.82 15.1799 3.74 15.1799 2.41C15.1799 1.08 16.2599 0 17.5899 0Z"
                  />
                </svg>
                <span>Statistics</span>
              </div>
            </li>
            <li id="profile">
              <div
                class="navItem"
                :class="{ active: currentNav === '/profile' }"
              >
                <svg
                  width="16"
                  height="20"
                  viewBox="0 0 16 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M8 13.1739C12.3386 13.1739 16 13.8789 16 16.599C16 19.32 12.3146 20 8 20C3.66237 20 0 19.295 0 16.575C0 13.8539 3.68538 13.1739 8 13.1739ZM8 0C10.9391 0 13.294 2.35402 13.294 5.29105C13.294 8.22808 10.9391 10.5831 8 10.5831C5.0619 10.5831 2.70601 8.22808 2.70601 5.29105C2.70601 2.35402 5.0619 0 8 0Z"
                  />
                </svg>
                <span>Profile</span>
              </div>
            </li>
            <li id="admin" v-if="address === admin">
              <div class="navItem" :class="{ active: currentNav === '/admin' }">
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 16 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M10.7171 0C11.4734 0 12.1581 0.42 12.5362 1.04C12.7201 1.34 12.8428 1.71 12.8121 2.1C12.7917 2.4 12.8837 2.7 13.0472 2.98C13.5684 3.83 14.7232 4.15 15.6225 3.67C16.6342 3.09 17.9117 3.44 18.4942 4.43L19.1789 5.61C19.7716 6.6 19.4446 7.87 18.4227 8.44C17.554 8.95 17.2474 10.08 17.7686 10.94C17.9321 11.21 18.1161 11.44 18.4022 11.58C18.7599 11.77 19.0358 12.07 19.23 12.37C19.6081 12.99 19.5775 13.75 19.2096 14.42L18.4942 15.62C18.1161 16.26 17.4109 16.66 16.6853 16.66C16.3277 16.66 15.9291 16.56 15.6021 16.36C15.3364 16.19 15.0298 16.13 14.7027 16.13C13.691 16.13 12.8428 16.96 12.8121 17.95C12.8121 19.1 11.8719 20 10.6967 20H9.3068C8.12133 20 7.18113 19.1 7.18113 17.95C7.16069 16.96 6.31247 16.13 5.30073 16.13C4.96348 16.13 4.6569 16.19 4.40141 16.36C4.07438 16.56 3.6656 16.66 3.31813 16.66C2.58232 16.66 1.87717 16.26 1.49905 15.62L0.793898 14.42C0.415774 13.77 0.395334 12.99 0.773459 12.37C0.936972 12.07 1.24356 11.77 1.59102 11.58C1.87717 11.44 2.06112 11.21 2.23486 10.94C2.74584 10.08 2.43925 8.95 1.57059 8.44C0.558848 7.87 0.231821 6.6 0.814337 5.61L1.49905 4.43C2.09178 3.44 3.35901 3.09 4.38097 3.67C5.27007 4.15 6.42488 3.83 6.94608 2.98C7.10959 2.7 7.20157 2.4 7.18113 2.1C7.16069 1.71 7.27311 1.34 7.46728 1.04C7.8454 0.42 8.53012 0.02 9.27614 0H10.7171ZM10.012 7.18C8.40748 7.18 7.10959 8.44 7.10959 10.01C7.10959 11.58 8.40748 12.83 10.012 12.83C11.6164 12.83 12.8837 11.58 12.8837 10.01C12.8837 8.44 11.6164 7.18 10.012 7.18Z"
                  />
                </svg>
                <span>admin</span>
              </div>
            </li>
          </ul>
        </nav>
      </div>
    </transition>
    <transition name="right">
      <div class="right" v-show="showRight">
        <account />
        <recent-transac />
      </div>
    </transition>
  </div>
  <div v-else><wrong /></div>
</template>

<script setup lang="ts">
//handle navbar change
import { useETHStore } from '@/store'
import { onMounted, ref } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import Account from './right/account.vue'
import RecentTransac from './right/recentTransac.vue'
import wrong from '../../components/erro.vue'

import { Contract } from 'web3-eth-contract'
import { getUsernameByAddress } from '../../api/mainSys'

const router = useRouter()
const route = useRoute()
const currentNav = ref(route.path)
const ETHStore = useETHStore()

const address = ETHStore.accounts ? ETHStore.accounts[0] : ''
const contract = ETHStore.contract as Contract
let name = ref('')
getUsernameByAddress(contract, address).then((value) => {
  name.value = value
})

const handleClick = (e: Event) => {
  let target = e.target as HTMLElement
  while (target.tagName != 'ul') {
    if (target.tagName.toLowerCase() == 'li') {
      currentNav.value = target.id === 'dashboard' ? '/' : '/' + target.id
      router.push({
        name: `${target.id}`,
      })
      break
    }
    target = target.parentElement as HTMLElement
  }
}
//left animation
const showLeft = ref(false)
onMounted(() => {
  setTimeout(() => {
    showLeft.value = true
  }, 0)
})
//right animation
const showRight = ref(false)
onMounted(() => {
  setTimeout(() => {
    showRight.value = true
  })
})
//detect network
const store = useETHStore()
const isETHLoaded = store.isWeb3Load
//detect admin
const admin = process.env.VUE_APP_ADMIN_ADDRESS
</script>

<style scoped lang="less">
.left-enter-from {
  transform: translateX(-100%);
}
.left-enter-active {
  transition: all 0.3s ease;
}
.left-enter-to {
  transform: none;
}
.right-enter-from {
  transform: translateY(-100%);
}
.right-enter-active {
  transition: all 1s ease;
}
.right-enter-to {
  transform: none;
}
.container {
  display: flex;
  background-color: #f1f8ff;
  .main {
    height: 100vh;
    min-height: 968px;
    background-color: #fff;
    flex: 1;
  }
  .left {
    height: 100vh;
    min-height: 968px;
    width: 280px;
    background-color: #f1f8ff;
    order: -1;
    flex-shrink: 0;
    h2 {
      text-align: left;
      margin-left: 32px;
    }
    nav {
      margin-top: 93px;
      ul {
        li {
          padding-bottom: 10px;
          .navItem {
            position: relative;
            text-align: left;
            line-height: 64px;
            width: 207px;
            height: 64px;
            color: #b8bed9;
            border-radius: 16px;
            vertical-align: middle;
            &:hover {
              color: rgb(68, 102, 251);
              cursor: pointer;
              path {
                fill: rgb(68, 102, 251);
                transition: all 0.5s;
              }
            }
            &.active {
              background-color: rgb(68, 102, 251);
              color: white;
              transition: all 0.2s;
              box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
              path {
                fill: white;
              }
            }
            svg {
              margin-left: 27px;
              path {
                fill: #b8bed9;
              }
              &.posts {
                margin-left: 25px;
                margin-top: 15px;
              }
            }
            span {
              position: absolute;
              left: 72px;
            }
          }
        }
      }
    }
  }
  .right {
    height: 100vh;
    min-height: 968px;
    width: 324px;
    background-color: #fff;
    margin-left: 15px;
    margin-right: 15px;
    flex-shrink: 0;
  }
}
</style>
